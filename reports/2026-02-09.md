# Daily Report — 2026-02-09

## Summary

No version update today (SDK remains at 0.2.37), but research agent successfully evaluated 13 new bug issues and 1 issue state change. The research agent added 6 new known issues to SKILL.md (including MCP timeout bug, ripgrep permissions issue, and concurrent query() failures) and added 1 new usage rule. One tracked external issue (claude-code #4850) was closed. All agents also updated to use streaming query() API with proper cost tracking.

## Pipeline Status

| Step | Result | Duration | Notes |
|------|--------|----------|-------|
| Monitor | success | — | Changes detected: 10 new bug issues + 1 issue state change |
| Update | skipped | — | No version update needed |
| Research | success | — | 13 issues evaluated, 6 known issues added, 1 rule added |
| Verify | skipped | — | No update to verify |
| Report | success | — | |

_Note: Pipeline log was not created (lightweight run)._

## Monitor

**Changes detected**: yes

The monitor detected the following changes:

1. **Issue state change (1)**:
   - [claude-code #4850](https://github.com/anthropics/claude-code/issues/4850) "MCP Python SDK unicode issue" changed from `open` → `closed`

2. **New bug issues (10)**:
   - #164: sessions-index.json not updated by SDK, only by CLI
   - #163: AgentDefinition.tools is intersected with Options.tools, making sub-agent tool sets dependent on session base
   - #158: Subagents are unable to inherit MCPs that are created via `createSdkMcpServer` starting v0.2.23
   - #157: ANTHROPIC_LOG=debug corrupts SDK protocol - debug logs should go to stderr
   - #154: V2 Session API (unstable_v2_createSession) does not support mcpServers option
   - #153: Bug: '(no content)' text blocks are emitted before thinking blocks
   - #152: Bug: Calling `close()` before first assistant message makes session non-resumable
   - #150: SDK fails to discover bundled CLI when bundled with bun build
   - #148: Race condition: endInput() allows writes to ended stream causing 'write after end' errors
   - #144: `ANTHROPIC_BASE_URL` via env option broken in v0.2.8+

Last scanned issue number advanced from 142 → 166.

## Research

**Status**: Success

The research agent evaluated 13 issues total (3 from backlog scan + 10 from new bug issues):

### Known Issues Added (6)

1. **#144**: ANTHROPIC_BASE_URL via env option broken
   - **Verdict**: Added as Known Issue #6
   - **Reason**: Confirmed regression affecting custom base URL users, workaround available
   - **Fix**: Downgrade to v0.2.7 or set as environment variable before process start

2. **#122**: SDK MCP servers fail from concurrent query() calls
   - **Verdict**: Added as Known Issue #7
   - **Reason**: Confirmed bug affecting concurrent usage, clear workaround available
   - **Fix**: Use stdio MCP servers instead of `createSdkMcpServer()`

3. **#121**: Missing @anthropic-ai/sdk dependency
   - **Verdict**: Added as Known Issue #8
   - **Reason**: Common TypeScript footgun, simple fix
   - **Fix**: `npm install @anthropic-ai/sdk` as peer dependency

4. **#129**: Ripgrep binary lacks execute permission on Remote SSH
   - **Verdict**: Added as Known Issue #9
   - **Reason**: VS Code extension developers hit this, clear workaround available
   - **Fix**: `chmod +x` ripgrep binaries at activation

5. **#118**: MCP tool calls timeout at 5 minutes
   - **Verdict**: Added as Known Issue #10
   - **Reason**: Confirmed bug blocking long-running MCP tools, no workaround
   - **Status**: Long-running MCP tools (>5min) not currently supported

6. **#106**: Opaque process exited with code 1 errors
   - **Verdict**: Added as Known Issue #11
   - **Reason**: Common production pain point, workaround via debug option
   - **Fix**: Enable `debug: true` or `debugFile: 'debug.log'`

### Rules Added (1)

1. **#115**: allowedTools doesn't work with bypassPermissions mode
   - **Verdict**: Added usage rule
   - **Reason**: User error — bypassPermissions disables allowedTools restriction
   - **Fix**: Use default or acceptEdits permission mode for allowedTools to work

### Issues Skipped (6)

- **#161**: ReferenceError: Bun is not defined — false alarm, closed by reporter
- **#155**: Invalid model ID causes crash — issue not reproducible, closed
- **#156**: SDK incompatibility with Claude Code 2.1.x — fly.io specific, not SDK bug
- **#151**: Breaking: Duplicate tool_use IDs in v0.2.19 — fixed in v0.2.20
- **#158**: Subagents unable to inherit createSdkMcpServer MCPs — fixed in v0.2.34
- **#130**: Async subagents error with streaming mode — fixed in CLI 2.1.7

### State Updates

- Tracked issues: 5 → 11 (added #144, #122, #121, #129, #118, #106)
- Tracked external issues: 1 → 0 (removed closed #4850)
- Researched issues: 0 → 13
- Last scanned issue number: 142 → 166
- Total known issues in SKILL.md: 5 → 11

## Code Improvements

All agent scripts (update, research, mending, report) were updated to:
- Use streaming `query()` API instead of awaiting the full result
- Count turns accurately during streaming
- Access `total_cost_usd` from result message (new API format)
- Add `allowDangerouslySkipPermissions: true` for SDK v0.2+ compatibility

Monitor script was updated to fix bash loop issues with jq piping.

## Cost

| Agent | Cost | Turns |
|-------|------|-------|
| Research | $0.84 | 53 |
| Report | $0.05 | 6 |
| **Total** | **$0.89** | **59** |

## State

Current tracked state after today's run:

- **SDK version**: 0.2.37 (unchanged)
- **Tracked issues**: 11 open issues across anthropics/claude-agent-sdk-typescript
  - #131: MCP Config Missing type Field
  - #132: Orphan Subagents
  - #137: Unicode Line Separators Break JSON
  - #138: Context Length Exceeded
  - #142: Orphan Subagents (duplicate)
  - #144: ANTHROPIC_BASE_URL via env option broken
  - #122: SDK MCP servers fail from concurrent query() calls
  - #121: Missing @anthropic-ai/sdk dependency
  - #129: Ripgrep binary lacks execute permission on Remote SSH
  - #118: MCP tool calls timeout at 5 minutes
  - #106: Opaque process exited with code 1 errors
- **Tracked external issues**: 0 (removed closed claude-code #4850)
- **Total researched issues**: 13
- **Last scanned issue number**: 166
- **Last research date**: 2026-02-09

## Uncommitted Changes

The following files have uncommitted changes from today's run:

- `SKILL.md` — 6 new known issues + formatting updates
- `agent/state.json` — research results + new tracked issues
- `agent/update-agent.ts` — streaming API migration
- `agent/research-agent.ts` — streaming API migration
- `agent/mending-agent.ts` — streaming API migration
- `agent/report-agent.ts` — streaming API migration
- `agent/monitor.sh` — bash loop fixes
- `rules/claude-agent-sdk.md` — new allowedTools rule

These will be committed by the CI workflow after this report completes.
